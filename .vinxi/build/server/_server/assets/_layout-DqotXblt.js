import{jsx as e,jsxs as r}from"react/jsx-runtime";import{useNavigate as ve,useRouter as Ra,Link as se,createFileRoute as _a,lazyRouteComponent as Ba,Outlet as Ye}from"@tanstack/react-router";import{c as u,u as La,o as je,B as L,i as $a,k as Ua,l as Fa,p as Wa,j as Va,e as Oe,f as Me,g as De,q as Ha,r as Ga,s as Pe,t as Ae,h as xe,v as Ne,S as ye,T as ge,D as Ze,a as Je,b as Qe,w as qa,x as fe,y as Ie,z as $,A as ze,C as Ka,E as Ce,F as Ya,G as Za,H as Ja,I as Qa}from"./index-eGnkU4Qz.js";import*as y from"react";import{useState as R,useEffect as Q,useMemo as Ve,useRef as Xa}from"react";import{Slot as Xe}from"@radix-ui/react-slot";import{cva as ea}from"class-variance-authority";import{PanelLeftIcon as et,ChevronUp as at,ChevronDown as aa,Briefcase as He,BriefcaseIcon as tt,FolderOpen as rt,Folder as nt,MessageSquare as ta,X as ra,Check as na,Search as it,Plus as st,ChevronLeft as ot,ChevronRight as ct,PlusCircle as lt,ChevronsUpDown as dt,Sparkles as mt,BadgeCheck as ut,CreditCard as ht,Bell as pt,LogOut as gt,SquarePen as ft,Factory as bt,Users as vt,Settings as xt,Server as Nt}from"lucide-react";import*as wt from"@radix-ui/react-separator";import{useAtom as Y,useSetAtom as G,useAtomValue as be,atom as yt}from"jotai";import{toast as U}from"sonner";import*as z from"@radix-ui/react-dialog";import*as Ct from"@radix-ui/react-label";import*as Se from"@radix-ui/react-checkbox";import{b as le,a as ia}from"./getRequestClient-BlbUj71l.js";import{v4 as It}from"uuid";import{Command as P}from"cmdk";import*as Ee from"@radix-ui/react-avatar";import{AvatarImage as St}from"@radix-ui/react-avatar";import{E as Tt,c as sa}from"./client-BOYEY5wa.js";import{createAuthClient as kt}from"better-auth/react";import{organizationClient as jt,adminClient as Ot,emailOTPClient as Mt}from"better-auth/client/plugins";import{createServerFn as oa}from"@tanstack/start-client-core";import"@radix-ui/react-dropdown-menu";import"@radix-ui/react-scroll-area";import"@radix-ui/react-tooltip";import"clsx";import"tailwind-merge";import"@tanstack/start-server-core";import"tiny-invariant";const Te=y.forwardRef(({className:a,type:t,...s},o)=>e("input",{type:t,className:u("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:o,...s}));Te.displayName="Input";function Re({className:a,orientation:t="horizontal",decorative:s=!0,...o}){return e(wt.Root,{"data-slot":"separator-root",decorative:s,orientation:t,className:u("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",a),...o})}const Dt="sidebar_state",Pt=60*60*24*7,At="16rem",zt="18rem",Et="3rem",Rt="b",ca=y.createContext(null);function de(){const a=y.useContext(ca);if(!a)throw new Error("useSidebar must be used within a SidebarProvider.");return a}const _e=y.forwardRef(({defaultOpen:a=!0,open:t,onOpenChange:s,className:o,style:l,children:v,...c},b)=>{const N=La(),[h,k]=y.useState(!1),[d,m]=y.useState(a),g=t??d,f=y.useCallback(S=>{const T=typeof S=="function"?S(g):S;s?s(T):m(T),document.cookie=`${Dt}=${T}; path=/; max-age=${Pt}`},[s,g]),I=y.useCallback(()=>N?k(S=>!S):f(S=>!S),[N,f,k]);y.useEffect(()=>{const S=T=>{T.key===Rt&&(T.metaKey||T.ctrlKey)&&(T.preventDefault(),I())};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[I]);const w=g?"expanded":"collapsed",F=y.useMemo(()=>({state:w,open:g,setOpen:f,isMobile:N,openMobile:h,setOpenMobile:k,toggleSidebar:I}),[w,g,f,N,h,k,I]);return e(ca.Provider,{value:F,children:e(je,{delayDuration:0,children:e("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":At,"--sidebar-width-icon":Et,...l},className:u("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",o),ref:b,...c,children:v})})})});_e.displayName="SidebarProvider";function _t({side:a="left",variant:t="sidebar",collapsible:s="offcanvas",className:o,children:l,...v}){const{isMobile:c,state:b,openMobile:N,setOpenMobile:h}=de();return s==="none"?e("div",{"data-slot":"sidebar",className:u("bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",o),...v,children:l}):c?r($a,{open:N,onOpenChange:h,...v,children:[r(Ua,{className:"sr-only",children:[e(Fa,{children:"Sidebar"}),e(Wa,{children:"Displays the mobile sidebar."})]}),e(Va,{"data-sidebar":"sidebar","data-slot":"sidebar","data-mobile":"true",className:"bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden",style:{"--sidebar-width":zt},side:a,children:e("div",{className:"flex h-full w-full flex-col",children:l})})]}):r("div",{className:"group peer text-sidebar-foreground hidden md:block","data-state":b,"data-collapsible":b==="collapsed"?s:"","data-variant":t,"data-side":a,"data-slot":"sidebar",children:[e("div",{className:u("relative h-svh w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]":"group-data-[collapsible=icon]:w-(--sidebar-width-icon)")}),e("div",{className:u("fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",a==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]":"group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",o),...v,children:e("div",{"data-sidebar":"sidebar",className:"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm",children:l})})]})}function la({className:a,onClick:t,...s}){const{toggleSidebar:o}=de();return r(L,{"data-sidebar":"trigger","data-slot":"sidebar-trigger",variant:"ghost",size:"icon",className:u("h-7 w-7",a),onClick:l=>{t?.(l),o()},...s,children:[e(et,{}),e("span",{className:"sr-only",children:"Toggle Sidebar"})]})}function Bt({className:a,...t}){const{toggleSidebar:s}=de();return e("button",{"data-sidebar":"rail","data-slot":"sidebar-rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:s,title:"Toggle Sidebar",className:u("hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex","in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",a),...t})}function da({className:a,...t}){return e("main",{"data-slot":"sidebar-inset",className:u("bg-background relative flex min-h-svh flex-1 flex-col","peer-data-[variant=inset]:min-h-[calc(100svh-(--spacing(4)))] md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",a),...t})}function Lt({className:a,...t}){return e("div",{"data-slot":"sidebar-header","data-sidebar":"header",className:u("flex flex-col gap-2 p-2",a),...t})}function $t({className:a,...t}){return e("div",{"data-slot":"sidebar-footer","data-sidebar":"footer",className:u("flex flex-col gap-2 p-2",a),...t})}function Ut({className:a,...t}){return e(Re,{"data-slot":"sidebar-separator","data-sidebar":"separator",className:u("bg-sidebar-border mx-2 w-auto",a),...t})}function Ft({className:a,...t}){return e("div",{"data-slot":"sidebar-content","data-sidebar":"content",className:u("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",a),...t})}function oe({className:a,...t}){return e("div",{"data-slot":"sidebar-group","data-sidebar":"group",className:u("relative flex w-full min-w-0 flex-col p-2",a),...t})}function ce({className:a,asChild:t=!1,...s}){return e(t?Xe:"div",{"data-slot":"sidebar-group-label","data-sidebar":"group-label",className:u("text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",a),...s})}function ae({className:a,...t}){return e("ul",{"data-slot":"sidebar-menu","data-sidebar":"menu",className:u("flex w-full min-w-0 flex-col gap-1",a),...t})}function Z({className:a,...t}){return e("li",{"data-slot":"sidebar-menu-item","data-sidebar":"menu-item",className:u("group/menu-item relative",a),...t})}const Wt=ea("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:p-0!"}},defaultVariants:{variant:"default",size:"default"}});function J({asChild:a=!1,isActive:t=!1,variant:s="default",size:o="default",tooltip:l,className:v,...c}){const b=a?Xe:"button",{isMobile:N,state:h}=de(),k=e(b,{"data-slot":"sidebar-menu-button","data-sidebar":"menu-button","data-size":o,"data-active":t,className:u(Wt({variant:s,size:o}),v),...c});return l?(typeof l=="string"&&(l={children:l}),r(Oe,{children:[e(Me,{asChild:!0,children:k}),e(De,{side:"right",align:"center",hidden:h!=="collapsed"||N,...l})]})):k}function Vt({items:a,className:t}){const s=ve(),[o,l]=Y(Ha),[v,c]=Y(Ga),[b,N]=y.useState(!1),[h,k]=y.useState(null),[d,m]=Y(Pe),[g,f]=Y(Ae),[I,w]=Y(xe);y.useEffect(()=>{if(g){const i=a.find(p=>p.projects?.find(x=>x.id===g));i&&((!d||d!==i.id)&&m(i.id),l(p=>({...p,[i.id]:!0})))}},[g,a,m,d]),y.useEffect(()=>{if(I?.projectId){const i=I.projectId;let p;for(const x of a){const M=x.projects?.find(A=>A.id===i);if(M){p=M,(!d||d!==x.id)&&m(x.id),l(A=>({...A,[x.id]:!0}));break}}p&&(!g||g!==p.id)&&f(p.id),p&&c(x=>({...x,[p.id]:!0}))}},[I,a,m,f,d,g]);const F=i=>{l(p=>({...p,[i.id]:!p[i.id]})),(!d||d!==i.id)&&(m(i.id),g&&g!==i.id&&(f(void 0),w(void 0)))},S=i=>{m(i.id),g&&g!==i.id&&(f(void 0),w(void 0)),s({to:"/teamspace/$teamspaceId",params:{teamspaceId:i.id},viewTransition:!0})},T=i=>{if(c(p=>({...p,[i.id]:!p[i.id]})),!d||d!==i.teamspaceId){const p=a.find(x=>x.id===i.teamspaceId);p&&(m(p.id),l(x=>({...x,[p.id]:!0})))}f(i.id),I&&I.projectId!==i.id&&w(void 0),s({to:"/project/$projectId",params:{projectId:i.id},viewTransition:!0})},_=i=>{if(i.projectId){let p;for(const x of a){const M=x.projects?.find(A=>A.id===i.projectId);if(M){p=M,(!d||d!==x.id)&&m(x.id);break}}p&&f(p.id)}w(i),s({to:"/chat/$chatroomId",params:{chatroomId:i.id},viewTransition:!0})},W=()=>{N(!b)},X=i=>{k(i.id),N(!1),S(i)},re=(i,p=2)=>{const x=I?.id===i.id,M=p*12;return e("div",{children:e(Z,{children:r(J,{className:"w-full justify-start hover:bg-accent/50",onClick:()=>_(i),style:{paddingLeft:`${M}px`},children:[e(ta,{className:`mr-2 h-4 w-4 ${x?"text-orange-500":""}`}),i.name.length>20?i.name.slice(0,20)+"...":i.name]})})},i.id)},me=(i,p=1)=>{const x=v[i.id],M=g===i.id,A=i.chatrooms&&i.chatrooms.length>0,ne=p*12;return r("div",{children:[e(Z,{children:r(J,{className:"w-full justify-start hover:bg-accent/50",onClick:()=>T(i),style:{paddingLeft:`${ne}px`},children:[x&&A?e(rt,{className:`mr-2 h-5 w-5 ${M?"text-emerald-500":""}`}):e(nt,{className:`mr-2 h-5 w-5 ${M?"text-emerald-500":""}`}),i.name.length>20?i.name.slice(0,20)+"...":i.name]})}),A&&x&&e("div",{children:i.chatrooms.map(ee=>re(ee,p+1))})]},i.id)},B=(i,p=0,x=!1)=>{const M=o[i.id],A=d===i.id||x,ne=i.projects&&i.projects.length>0,ee=p===0?0:p*12;return r("div",{children:[e(Z,{children:r(J,{className:"w-full justify-start hover:bg-accent/50",onClick:()=>{S(i),F(i)},style:{paddingLeft:ee?`${ee}px`:void 0},children:[M?e(tt,{className:`mr-2 h-5 w-5 ${A?"text-indigo-500":""}`}):e(He,{className:`mr-2 h-5 w-5 ${A?"text-indigo-500":""}`}),i.name.length>20?i.name.slice(0,20)+"...":i.name]})}),ne&&M&&e("div",{children:i.projects.map(he=>me(he,p+1))})]},i.id)},we=a.slice(0,4),V=a.length>4?a.slice(4):[],ue=h?a.find(i=>i.id===h):null;return r("div",{className:t,children:[we.map(i=>B(i)),ue&&B(ue,0,!0),V.length>0&&r("div",{children:[e(Z,{children:r(J,{className:"w-full justify-start mt-1 text-muted-foreground",onClick:W,children:[b?e(at,{className:"mr-2 h-4 w-4"}):e(aa,{className:"mr-2 h-4 w-4"}),"Show ",V.length," more"]})}),b&&e("div",{className:"pl-2 py-1 space-y-1 border-l-2 border-muted ml-2 mt-1",children:V.map(i=>e(Z,{children:r(J,{className:"w-full justify-start text-sm hover:bg-accent/50",onClick:()=>X(i),children:[e(He,{className:`mr-2 h-4 w-4 ${d===i.id?"text-primary":""}`}),i.name]})},i.id))})]})]})}const Ht="/_server/assets/IntelliOptima-Black-Text-Logo-z-6OsVSl.webp",Gt=z.Root,qt=z.Trigger,Kt=z.Portal,Yt=z.Close,ma=y.forwardRef(({className:a,...t},s)=>e(z.Overlay,{ref:s,className:u("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));ma.displayName=z.Overlay.displayName;const ua=y.forwardRef(({className:a,children:t,...s},o)=>r(Kt,{children:[e(ma,{}),r(z.Content,{ref:o,className:u("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,r(z.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e(ra,{className:"h-4 w-4"}),e("span",{className:"sr-only",children:"Close"})]})]})]}));ua.displayName=z.Content.displayName;const ha=({className:a,...t})=>e("div",{className:u("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});ha.displayName="DialogHeader";const pa=({className:a,...t})=>e("div",{className:u("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});pa.displayName="DialogFooter";const ga=y.forwardRef(({className:a,...t},s)=>e(z.Title,{ref:s,className:u("text-lg font-semibold leading-none tracking-tight",a),...t}));ga.displayName=z.Title.displayName;const fa=y.forwardRef(({className:a,...t},s)=>e(z.Description,{ref:s,className:u("text-sm text-muted-foreground",a),...t}));fa.displayName=z.Description.displayName;function H({className:a,...t}){return e(Ct.Root,{"data-slot":"label",className:u("text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...t})}const Zt=ea("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ge({className:a,variant:t,...s}){return e("div",{className:u(Zt({variant:t}),a),...s})}const ke=y.forwardRef(({className:a,...t},s)=>e(Se.Root,{ref:s,className:u("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...t,children:e(Se.Indicator,{className:u("flex items-center justify-center text-current"),children:e(na,{className:"h-4 w-4"})})}));ke.displayName=Se.Root.displayName;const ba=y.forwardRef(({className:a,...t},s)=>e(P,{ref:s,className:u("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...t}));ba.displayName=P.displayName;const va=y.forwardRef(({className:a,...t},s)=>r("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e(it,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e(P.Input,{ref:s,className:u("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...t})]}));va.displayName=P.Input.displayName;const xa=y.forwardRef(({className:a,...t},s)=>e(P.List,{ref:s,className:u("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...t}));xa.displayName=P.List.displayName;const Na=y.forwardRef((a,t)=>e(P.Empty,{ref:t,className:"py-6 text-center text-sm",...a}));Na.displayName=P.Empty.displayName;const wa=y.forwardRef(({className:a,...t},s)=>e(P.Group,{ref:s,className:u("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...t}));wa.displayName=P.Group.displayName;const Jt=y.forwardRef(({className:a,...t},s)=>e(P.Separator,{ref:s,className:u("-mx-1 h-px bg-border",a),...t}));Jt.displayName=P.Separator.displayName;const ya=y.forwardRef(({className:a,...t},s)=>e(P.Item,{ref:s,className:u("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a),...t}));ya.displayName=P.Item.displayName;function te({className:a,...t}){return e(Ee.Root,{"data-slot":"avatar",className:u("relative flex size-8 shrink-0 overflow-hidden rounded-full",a),...t})}function qe({className:a,...t}){return e(Ee.Image,{"data-slot":"avatar-image",className:u("aspect-square size-full",a),...t})}function Ke({className:a,...t}){return e(Ee.Fallback,{"data-slot":"avatar-fallback",className:u("bg-muted flex size-full items-center justify-center rounded-full",a),...t})}const Qt=()=>{const a=Tt("staging");return kt({baseURL:a,plugins:[jt(),Ot(),Mt()]})},{useSession:Be,getSession:Xt,signIn:Br,signUp:Lr,signOut:er,emailOtp:$r,verifyEmail:Ur,organization:ar,useListOrganizations:Ca,useActiveOrganization:Ia}=Qt();function tr(){const a=ve(),[t,s]=R(!1),o=G(Ne),l=G(Pe),v=G(Ae),c=Ia(),[b,N]=R(!1),[h,k]=R(1),d=[{id:1,label:"Teamspace Details"},{id:2,label:"Teamspace Members"},{id:3,label:"Project Details"},{id:4,label:"Project Members"}],[m,g]=R({name:"",description:"",context:""}),[f,I]=R({name:"Default Project",description:"",context:"",isPrivate:!1}),[w,F]=R([]),[S,T]=R([]),[_,W]=R("CONTRIBUTOR"),[X,re]=R(""),[me,B]=R([]),[we,V]=R(!1),ue=n=>{re(n),V(!0);const{data:C}=c;if(!C||!C.members){B([]),V(!1);return}le().auth.handler().then(({user:j})=>{const E=j?.email;setTimeout(()=>{if(n.trim()==="")B([]);else try{console.log("Organization members:",C.members);const q=C.members.filter(O=>{if(!O?.user)return!1;const K=O.user.name&&O.user.name.toLowerCase().includes(n.toLowerCase()),pe=O.user.email&&O.user.email.toLowerCase().includes(n.toLowerCase()),ie=E&&O.user.email===E;return(K||pe)&&!ie}).map(O=>(console.log("Processing member:",O),{memberId:O.id,userId:O.user.id,name:O.user.name||"Unknown",email:O.user.email||"",image:O.user.image||`https://ui-avatars.com/api/?name=${encodeURIComponent(O.user.name||"Unknown")}`,role:"CONTRIBUTOR"}));console.log("Search results:",q),B(q)}catch(q){console.error("Error filtering organization members:",q),B([])}V(!1)},300)}).catch(j=>{console.error("Error getting current user:",j),V(!1),B([])})},i=n=>{if(console.log("Adding user to teamspace:",n),w.some(j=>j.email===n.email)){U.error("This user has already been added");return}const C={id:It(),userId:n.userId,role:_,invitedByUserId:"",teamspaceId:"",email:n.email,name:n.name||"Unknown",image:n.image};console.log("Created new teamspace member:",C),F(j=>[...j,C]),re(""),B([])},p=n=>{g({...m,[n.target.name]:n.target.value})},x=n=>{I({...f,[n.target.name]:n.target.value})},M=n=>{I({...f,isPrivate:n})},A=n=>{n&&(F(w.filter(C=>C.id!==n)),T(S.filter(C=>C.id!==n)))},ne=()=>{if(h===1&&!m.name.trim()){U.error("Teamspace name is required");return}if(h===2&&console.log("Teamspace members before going to step 3:",w),h===3&&!f.name.trim()){U.error("Project name is required");return}k(h+1)},ee=()=>{k(h-1)},he=n=>{switch(n){case"OWNER":return"bg-green-100 text-green-800";case"ADMIN":return"bg-red-100 text-red-800";case"MEMBER":return"bg-blue-100 text-blue-800";case"VIEWER":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};Q(()=>{h===4&&(console.log("Entering step 4 - Project Members selection"),T([]))},[h]);const Aa=(n,C)=>{if(console.log("Toggle project member:",n.name,C),C){const j={id:n.id,projectId:"",userId:n.userId,role:n.role,invitedByUserId:"",email:n.email,name:n.name,image:n.image};console.log("Adding to project members:",j),T(E=>[...E,j])}else console.log("Removing from project members:",n.id),T(j=>j.filter(E=>E.id!==n.id))},Fe=async n=>{if(n.preventDefault(),!t){s(!0);try{const C=le(),{session:j,userID:E,user:q}=await C.auth.handler();console.log("Current user:",{userID:E,email:q.email}),console.log("All teamspace members before filtering:",w);const O=w.filter(D=>D.email&&D.email!==q.email).map(D=>(console.log("Adding member to teamspace API request:",D),{userId:D.userId,role:D.role,invitedByUserId:E,teamspaceId:""}));console.log("Final teamspace members list for API:",O),console.log("Creating teamspace:",m.name);const{data:K}=await C.chatrooms.createTeamspace({name:m.name,description:m.description,context:m.context,creatorId:E,members:O});console.log("Teamspace created:",K),console.log("All project members before filtering:",S);const pe=S.filter(D=>D.email&&D.email!==q.email).map(D=>(console.log("Adding member to project API request:",D),{projectId:"",userId:D.userId,role:D.role,invitedByUserId:E}));console.log("Final project members list for API:",pe),console.log("Creating project:",f.name);const{data:ie}=await C.chatrooms.createProject({teamspaceId:K.id,name:f.name,description:f.description,context:f.context,creatorId:E,isPrivate:f.isPrivate,members:pe});console.log("Project created:",ie),K.projects.push(ie),o(D=>[...D,K]),l(K.id),v(ie.id),U.success("Teamspace and project created successfully"),N(!1),setTimeout(()=>{a({to:"/teamspace/$teamspaceId",params:{teamspaceId:K.id},viewTransition:!0})},100)}catch(C){console.error("Error creating teamspace:",C),U.error("Failed to create teamspace")}finally{s(!1)}}},We=()=>{k(1),g({name:"",description:"",context:""}),I({name:"Default Project",description:"",context:"",isPrivate:!1}),F([]),T([]),W("CONTRIBUTOR"),re(""),B([]),V(!1)};Q(()=>{b||We()},[b]);const za=()=>{switch(h){case 1:return r("div",{className:"space-y-4",children:[r("h3",{className:"font-medium text-lg flex items-center",children:[e("div",{className:"flex h-6 w-6 items-center justify-center rounded-lg bg-indigo-100 text-indigo-700 mr-2",children:e("span",{className:"text-xs font-semibold",children:"1"})}),"Teamspace Details"]}),r("div",{className:"grid gap-3",children:[r("div",{className:"grid gap-2",children:[r(H,{htmlFor:"teamspace-name",children:["Teamspace Name ",e("span",{className:"text-red-500",children:"*"})]}),e(Te,{id:"teamspace-name",name:"name",value:m.name,onChange:p,placeholder:"e.g. Marketing Team",required:!0})]}),r("div",{className:"grid gap-2",children:[e(H,{htmlFor:"teamspace-description",children:"Description"}),e(ge,{id:"teamspace-description",name:"description",value:m.description,onChange:p,placeholder:"What is this teamspace for?"})]}),r("div",{className:"grid gap-2",children:[e(H,{htmlFor:"teamspace-context",children:"Context"}),e(ge,{id:"teamspace-context",name:"context",value:m.context,onChange:p,placeholder:"Any additional context for AI assistants"})]})]})]});case 2:return r("div",{className:"space-y-4",children:[r("h3",{className:"font-medium text-lg flex items-center",children:[e("div",{className:"flex h-6 w-6 items-center justify-center rounded-lg bg-indigo-100 text-indigo-700 mr-2",children:e("span",{className:"text-xs font-semibold",children:"2"})}),"Teamspace Members"]}),r("div",{className:"space-y-4",children:[r("div",{className:"flex items-center justify-between",children:[e(H,{children:"Search for users"}),r("div",{className:"flex items-center gap-2",children:[e(H,{htmlFor:"member-role",className:"text-sm",children:"Role:"}),r("select",{id:"member-role",value:_,onChange:n=>W(n.target.value),className:"px-3 py-1 text-sm border rounded-md",children:[e("option",{value:"OWNER",children:"Owner"}),e("option",{value:"ADMIN",children:"Admin"}),e("option",{value:"CONTRIBUTOR",children:"Contributor"}),e("option",{value:"VIEWER",children:"Viewer"})]})]})]}),e("div",{className:"relative",children:r(ba,{className:"rounded-lg border shadow-md",children:[e(va,{placeholder:"Search users by name or email...",value:X,onValueChange:ue}),e(xa,{children:we?e("div",{className:"py-6 text-center text-sm",children:"Searching..."}):me.length===0&&X?e(Na,{children:"No users found."}):e(wa,{heading:"Users",children:e(ye,{className:"h-[200px]",children:me.map(n=>r(ya,{value:n.email,className:"flex items-center justify-between cursor-pointer",children:[r("div",{className:"flex items-center gap-2",children:[e(te,{children:e("img",{src:n.image,alt:n.name})}),r("div",{children:[e("p",{className:"text-sm font-medium",children:n.name}),e("p",{className:"text-xs text-muted-foreground",children:n.email})]})]}),e(L,{type:"button",variant:"ghost",size:"icon",onClick:()=>i(n),children:e(lt,{className:"h-4 w-4"})})]},n.memberId))})})})]})}),w.length>0&&r("div",{className:"mt-4",children:[e("h4",{className:"text-sm font-medium mb-2",children:"Selected Members"}),e(ye,{className:"h-[200px]",children:e("div",{className:"border rounded-md divide-y",children:w.map(n=>r("div",{className:"flex items-center justify-between p-3",children:[r("div",{className:"flex items-center gap-3",children:[n.image&&e(te,{className:"h-8 w-8",children:e("img",{src:n.image,alt:n.name||n.email||""})}),r("div",{children:[n.name&&e("p",{className:"text-sm font-medium",children:n.name}),e("p",{className:"text-xs text-muted-foreground",children:n.email})]}),e(Ge,{className:he(n.role),children:n.role})]}),r(L,{variant:"ghost",size:"sm",onClick:()=>A(n.id),className:"h-8 w-8 p-0",children:[e(ra,{className:"h-4 w-4"}),e("span",{className:"sr-only",children:"Remove"})]})]},n.id))})})]}),w.length===0&&e("p",{className:"text-sm text-muted-foreground mt-2",children:"No members added yet. You will be added as an Owner automatically."})]})]});case 3:return r("div",{className:"space-y-4",children:[r("h3",{className:"font-medium text-lg flex items-center",children:[e("div",{className:"flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-700 mr-2",children:e("span",{className:"text-xs font-semibold",children:"3"})}),"Project Details"]}),r("div",{className:"grid gap-3",children:[r("div",{className:"grid gap-2",children:[r(H,{htmlFor:"project-name",children:["Project Name ",e("span",{className:"text-red-500",children:"*"})]}),e(Te,{id:"project-name",name:"name",value:f.name,onChange:x,placeholder:"e.g. General",required:!0})]}),r("div",{className:"grid gap-2",children:[e(H,{htmlFor:"project-description",children:"Description"}),e(ge,{id:"project-description",name:"description",value:f.description,onChange:x,placeholder:"What is this project about?"})]}),r("div",{className:"grid gap-2",children:[e(H,{htmlFor:"project-context",children:"Context"}),e(ge,{id:"project-context",name:"context",value:f.context,onChange:x,placeholder:"Any specific context for this project"})]}),r("div",{className:"flex items-center space-x-2 mt-2",children:[e(ke,{id:"isPrivate",checked:f.isPrivate,onCheckedChange:M}),r("div",{className:"grid gap-1.5 leading-none",children:[e(H,{htmlFor:"isPrivate",className:"text-sm font-medium leading-none flex items-center",children:"Make project private"}),e("p",{className:"text-xs text-muted-foreground",children:"Private projects are only visible to invited members"})]})]})]})]});case 4:return r("div",{className:"space-y-4",children:[r("h3",{className:"font-medium text-lg flex items-center",children:[e("div",{className:"flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-700 mr-2",children:e("span",{className:"text-xs font-semibold",children:"4"})}),"Project Members"]}),e("p",{className:"text-sm text-muted-foreground",children:"Select which teamspace members to include in this project:"}),r("div",{className:"text-xs text-muted-foreground mb-2",children:["Available members: ",w.length,", Selected for project: ",S.length]}),w.length>0?e(ye,{className:"h-[300px] border rounded-md",children:e("div",{className:"divide-y",children:w.map(n=>{const C=S.some(j=>j.id===n.id);return e("div",{className:"flex items-center justify-between p-3",children:r("div",{className:"flex items-center gap-3",children:[e(ke,{id:`project-member-${n.id}`,checked:C,onCheckedChange:j=>{Aa(n,!!j)}}),r("div",{className:"flex items-center gap-2",children:[n.image&&e(te,{className:"h-8 w-8",children:e("img",{src:n.image,alt:n.name||n.email||""})}),r("div",{children:[n.name&&e("p",{className:"text-sm font-medium",children:n.name}),e("p",{className:"text-xs text-muted-foreground",children:n.email}),r("p",{className:"text-xs text-muted-foreground",children:["User ID: ",n.userId?.slice(0,6),"..."]})]})]}),e(Ge,{className:he(n.role),children:n.role})]})},n.id)})})}):e("p",{className:"text-sm",children:"No teamspace members to select from. You will be added as an Owner automatically."})]});default:return null}},Ea=()=>e("div",{className:"flex justify-center mb-6",children:d.map((n,C)=>r("div",{className:"flex items-center",children:[e("div",{className:`flex items-center justify-center w-8 h-8 rounded-full border-2 ${n.id===h?n.id<=2?"border-indigo-600 bg-indigo-600 text-white":"border-emerald-600 bg-emerald-600 text-white":n.id<h?n.id<=2?"border-indigo-600 bg-indigo-100 text-indigo-600":"border-emerald-600 bg-emerald-100 text-emerald-600":"border-gray-300 bg-white text-gray-500"}`,children:n.id<h?e(na,{className:"w-4 h-4"}):e("span",{className:"text-xs",children:n.id})}),C<d.length-1&&e("div",{className:`w-10 h-1 ${n.id<h?n.id<=1?"bg-indigo-600":"bg-emerald-600":"bg-gray-300"}`})]},n.id))});return e(je,{children:r(Oe,{children:[e(Me,{asChild:!0,children:r(Gt,{open:b,onOpenChange:n=>{t&&!n||N(n)},children:[e(qt,{asChild:!0,children:r(L,{variant:"ghost",size:"icon",className:"h-6 w-6 p-0 ml-1 rounded-full hover:cursor-pointer",children:[e(st,{className:"h-4 w-4"}),e("span",{className:"sr-only",children:"Create Teamspace"})]})}),e(ua,{className:"sm:max-w-[600px]",children:r("form",{onSubmit:n=>{n.preventDefault(),h===4&&Fe(n)},children:[r(ha,{children:[e("div",{className:`h-1.5 w-full absolute top-0 left-0 rounded-t-lg ${h<=2?"bg-indigo-500":"bg-emerald-500"}`}),e(ga,{className:"text-xl mt-2",children:"Create New Teamspace"}),e(fa,{children:"Create a teamspace with a default project to organize your work."})]}),Ea(),e("div",{className:"py-4",children:za()}),r(pa,{className:"flex justify-between",children:[e("div",{children:h>1&&r(L,{type:"button",variant:"outline",onClick:ee,disabled:t,children:[e(ot,{className:"h-4 w-4 mr-2"}),"Back"]})}),r("div",{className:"flex gap-2",children:[e(Yt,{asChild:!0,children:e(L,{variant:"outline",type:"button",disabled:t,onClick:We,children:"Cancel"})}),h<4?r(L,{type:"button",onClick:ne,className:`${h<=2?"bg-indigo-600 hover:bg-indigo-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:t,children:["Next",e(ct,{className:"h-4 w-4 ml-2"})]}):e(L,{type:"button",onClick:n=>Fe(n),className:"bg-emerald-600 hover:bg-emerald-700",disabled:t,children:t?"Creating...":"Create Teamspace & Project"})]})]})]})})]})}),e(De,{children:e("p",{children:"Create Teamspace"})})]})})}const rr=()=>{const a=Ra();return async()=>{await er(),a.navigate({to:"/sign-in",reloadDocument:!0})}};function nr(){const{isMobile:a}=de(),t=Be().data,s=rr(),o=t?.user;return e(ae,{children:e(Z,{children:r(Ze,{children:[e(Je,{asChild:!0,children:r(J,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[r(te,{className:"h-8 w-8 rounded-lg",children:[e(qe,{src:o?.image||"",alt:o?.name||""}),e(Ke,{className:"rounded-lg",children:"CN"})]}),r("div",{className:"grid flex-1 text-left text-sm leading-tight",children:[e("span",{className:"truncate font-semibold",children:o?.name}),e("span",{className:"truncate text-xs",children:o?.email})]}),e(dt,{className:"ml-auto size-4"})]})}),r(Qe,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:a?"bottom":"right",align:"start",sideOffset:4,children:[e(qa,{className:"p-0 font-normal",children:r("div",{className:"flex items-center gap-2 px-1 py-1.5 text-left text-sm",children:[r(te,{className:"h-8 w-8 rounded-lg",children:[e(qe,{src:o?.image||"",alt:o?.name||""}),e(Ke,{className:"rounded-lg",children:"CN"})]}),r("div",{className:"grid flex-1 text-left text-sm leading-tight",children:[e("span",{className:"truncate font-semibold",children:o?.name}),e("span",{className:"truncate text-xs",children:o?.email})]})]})}),e(fe,{}),e(Ie,{children:r($,{children:[e(mt,{}),"Upgrade to Pro"]})}),e(fe,{}),r(Ie,{children:[r($,{children:[e(ut,{}),"Account"]}),r($,{children:[e(ht,{}),"Billing"]}),r($,{children:[e(pt,{}),"Notifications"]})]}),e(fe,{}),r($,{onClick:s,className:"text-red-500 focus:text-red-500",children:[e(gt,{}),"Log out"]})]})]})})})}function Sa({...a}){const t=ve(),s=be(Ne),o=be(ze),[l,v]=Y(xe),c=G(Pe),b=G(Ae),N=Ve(()=>Ka(o||[]),[o]),h=Ve(()=>{const g=new Date,f=new Date(g.getTime()-7*24*60*60*1e3),I=new Date(g.getTime()-30*24*60*60*1e3),w=N.slice(0,5),F=N.filter(_=>Ce(_)>=f&&!w.some(X=>X.id===_.id)).slice(0,5),S=N.filter(_=>{const W=Ce(_);return W<f&&W>=I}).slice(0,5),T=N.filter(_=>Ce(_)<I).slice(0,5);return{recent:w,previousWeek:F,previousMonth:S,previous:T}},[N]),k=g=>{if(v(g),g.projectId){const f=s?.find(I=>I.projects?.some(w=>w.id===g.projectId));if(f){c(f.id);const I=f.projects?.find(w=>w.id===g.projectId);I&&b(I.id)}}else c(void 0),b(void 0);t({to:"/chat/$chatroomId",params:{chatroomId:g.id},viewTransition:!0})},d=()=>{v(void 0),b(void 0),c(void 0),setTimeout(()=>{t({to:"/chat",viewTransition:!0})},100)},m=g=>e(Z,{children:e(J,{className:"max-w-full text-left",onClick:()=>k(g),children:r("div",{className:"flex items-center w-full overflow-hidden",children:[e(ta,{className:`h-4 w-4 flex-shrink-0 ${l?.id===g.id?"text-orange-500":""}`}),e("span",{className:"ml-2 truncate",children:g.name.length>20?g.name.slice(0,20)+"...":g.name})]})})},g.id);return r(_t,{className:"border-r-0 overflow-hidden",...a,children:[e(Lt,{children:r("div",{className:"flex items-center justify-between p-2",children:[e("button",{className:"flex items-start hover:cursor-pointer",onClick:d,children:e("img",{src:Ht,alt:"IntelliOptima",className:"h-8 object-contain object-left"})}),e(je,{children:r(Oe,{children:[e(Me,{asChild:!0,children:r(L,{size:"icon",variant:"ghost",onClick:d,children:[e(ft,{className:"h-5 w-5"}),e("span",{className:"sr-only",children:"New Chat"})]})}),e(De,{children:e("p",{children:"New Chat"})})]})})]})}),e(Ft,{className:"overflow-hidden",children:r("div",{className:"flex flex-col gap-4 overflow-hidden",children:[r(oe,{children:[r("div",{className:"flex items-center justify-between",children:[e(ce,{children:"Teamspaces"}),e(tr,{})]}),e(ae,{children:e(Vt,{items:s})})]}),e(Ut,{}),r(oe,{children:[e(ce,{children:"Recent"}),e(ae,{children:h.recent.map(m)})]}),h.previousWeek.length>0&&r(oe,{children:[e(ce,{children:"Previous 7 Days"}),e(ae,{children:h.previousWeek.map(m)})]}),h.previousMonth.length>0&&r(oe,{children:[e(ce,{children:"Previous 30 Days"}),e(ae,{children:h.previousMonth.map(m)})]}),h.previous.length>0&&r(oe,{children:[e(ce,{children:"Previous"}),e(ae,{children:h.previous.map(m)})]}),!N.length&&e("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:"No recent chats. Start a new conversation using the button above."})]})}),e(Bt,{}),e($t,{className:"flex items-center",children:e(nr,{})})]})}function Ta({...a}){return e("nav",{"aria-label":"breadcrumb","data-slot":"breadcrumb",...a})}function ka({className:a,...t}){return e("ol",{"data-slot":"breadcrumb-list",className:u("text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",a),...t})}function ja({className:a,...t}){return e("li",{"data-slot":"breadcrumb-item",className:u("inline-flex items-center gap-1.5",a),...t})}function Oa({className:a,...t}){return e("span",{"data-slot":"breadcrumb-page",role:"link","aria-disabled":"true","aria-current":"page",className:u("text-foreground font-normal",a),...t})}const ir="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='lucide%20lucide-building-2'%3e%3cpath%20d='M6%2022V4a2%202%200%200%201%202-2h8a2%202%200%200%201%202%202v18Z'/%3e%3cpath%20d='M6%2012H4a2%202%200%200%200-2%202v6a2%202%200%200%200%202%202h2'/%3e%3cpath%20d='M18%209h2a2%202%200%200%201%202%202v9a2%202%200%200%201-2%202h-2'/%3e%3cpath%20d='M10%206h4'/%3e%3cpath%20d='M10%2010h4'/%3e%3cpath%20d='M10%2014h4'/%3e%3cpath%20d='M10%2018h4'/%3e%3c/svg%3e";function Ma(){const{data:a,error:t}=Ia(),s=a,{data:o}=Ca(),l=ve();Q(()=>{t&&c()},[t]);const v=async(b,N)=>{await ar.setActive({organizationId:b}),await Xt({query:{disableCookieCache:!0}}),l(N?{to:N}:{reloadDocument:!0})},c=async()=>{o&&s?.id&&o.filter(b=>b.id!==s.id).length>0?await v(o.filter(b=>b.id!==s.id)[0].id):o&&o.length>0?await v(o[0].id):await v("")};return{changeActiveOrganization:v,activeOrganization:s,changeActiveOrganizationIfAny:c}}const Da=()=>{const{activeOrganization:a,changeActiveOrganization:t}=Ma(),{data:s}=Ca(),o=Be().data?.user,l=a?.members.some(c=>c.user.email===o?.email&&(c.role==="owner"||c.role==="admin")),v=async c=>{await t(c)};return e("div",{className:"flex items-center gap-4",children:r(Ze,{children:[e(Je,{asChild:!0,children:r(L,{variant:"ghost",className:"flex items-center gap-2 p-1",children:[e(te,{className:"h-8 w-8",children:e(St,{src:a?.logo||ir,alt:o?.name,className:"h-8 w-8"})}),a&&r("div",{className:"flex items-center gap-1",children:[e("span",{className:"",children:a.name}),e(aa,{className:"h-4 w-4"})]})]})}),e(Qe,{align:"end",className:"w-56",children:r(Ie,{children:[r(Ya,{children:[e(Za,{children:r(se,{className:"flex",to:"/organizations",children:[e(bt,{className:"mr-2 h-4 w-4"}),e("span",{children:"Organizations"})]})}),e(Ja,{children:r(Qa,{children:[s&&s.map(c=>e($,{onClick:()=>v(c.id),className:c.id===a?.id?"bg-accent":"",children:c.name},c.id)),e(fe,{}),e($,{asChild:!0,children:e(se,{to:"/organizations",children:"Manage Organizations"})})]})})]}),e($,{asChild:!0,disabled:!l,children:r(se,{to:"/members",children:[e(vt,{className:"mr-2 h-4 w-4"}),e("span",{children:"Team Members"})]})}),e($,{asChild:!0,disabled:!l,children:r(se,{to:"/organization-settings",children:[e(xt,{className:"mr-2 h-4 w-4"}),e("span",{children:"Settings"})]})}),e($,{asChild:!0,disabled:!l,children:r(se,{to:"/chat",children:[e(Nt,{className:"mr-2 h-4 w-4"}),e("span",{children:"AI Providers"})]})})]})})]})})},sr=yt([]),or=()=>{const{data:a}=Be(),[t,s]=Y(sr);return Q(()=>{t.length>0||(async()=>{const{data:l}=await le().auth.getOrganizationInvitationsByEmail();l&&s(l)})()},[a?.user.id]),{organizationInvitations:t,refetchInvitations:async()=>{const{data:l}=await le().auth.getOrganizationInvitationsByEmail();l&&s(l)}}};function Pa(a){const{changeActiveOrganization:t,changeActiveOrganizationIfAny:s}=Ma(),{refetchInvitations:o}=or(),[l,v]=R(!1),c=Xa(void 0);Q(()=>{if(!(l||!a||c.current))return(async()=>await b())(),()=>{c.current&&(console.log("CLOSING DOWN"),c.current.close())}},[a]);const b=async()=>{if(!l){c.current&&c.current.close(),v(!0);try{c.current=await le().eventStreamer.eventsStream(),c.current.socket.on("close",()=>{console.log("Socket closed, will attempt to reconnect if needed")}),c.current.socket.on("open",async()=>{console.log("EVENTSSTREAM ON OPEN HAPPENED!")}),c.current.socket.on("message",async d=>{if(d.data){const m=JSON.parse(d.data);m.notification&&N(m)}})}catch(d){console.error("Error connecting to chat:",d),v(!1)}}},N=async d=>{switch(d.notification.notificationType){case"ORGANIZATION_INVITATION":{await h(d);return}case"ORGANIZATION":{await k(d);return}default:throw new Error(`Unknown notification type: ${d.notification.notificationType}`)}},h=async d=>{const m=d.notification;switch(m.notificationHandling){case"ACCEPTED":await t(d.organizationId),U.info(`${m.memberName} accepted your invitation to join ${m.organizationName}.`);return;case"CANCELED":await o(),U.info(`Your invitation to join ${m.organizationName} has been canceled.`);return;case"RECEIVED":await o(),U.info(`You have been invited to join ${m.organizationName} by ${m.memberName}.`);return;case"REJECTED":await o(),U.info(`${m.memberName} rejected to join ${m.organizationName}.`);return;default:throw new Error(`Unknown notification type: ${d.notification.notificationType}`)}},k=async d=>{switch(d.notification.notificationHandling){case"KICKED":const m=d.notification;a===m.kickedMemberUserId&&(U.info(`You have been kicked from ${m.organizationName}.`),setTimeout(()=>s(),1e3));return;default:throw new Error(`Unknown notification type: ${d.notification.notificationType}`)}}}const cr=()=>Promise.resolve().then(()=>hr),lr=sa("app_routes_authed_layout_tsx--getTeamspaces_createServerFn_handler","/_server",(a,t)=>Le.__executeServer(a,t)),Le=oa().handler(lr,async()=>{try{const a=ia(),{data:t}=await a.chatrooms.getParticipatingTeamspaces();return t}catch{return[]}}),dr=sa("app_routes_authed_layout_tsx--getChatrooms_createServerFn_handler","/_server",(a,t)=>$e.__executeServer(a,t)),$e=oa().handler(dr,async()=>{const a=ia(),{data:t}=await a.chatrooms.getParticipatingChatroomsWithLatestMessages();return console.log("chatrooms",t),t}),Ue=_a("/_authed/_layout")({component:Ba(cr,"component",()=>Ue.ssr)});function mr(){const a=be(xe),t=G(Ne),s=G(ze),{userId:o}=Ue.useRouteContext();return Pa(o),Q(()=>{const l=async()=>{const c=await Le();t(c)},v=async()=>{const c=await $e();s(c)};Promise.all([l(),v()])},[]),r(_e,{children:[e(Sa,{}),r(da,{className:"flex flex-col h-screen overflow-y-auto",children:[r("header",{className:"sticky top-0 flex h-14 shrink-0 items-center gap-2 bg-background p-4",children:[r("div",{className:"flex flex-1 items-center gap-2 px-3",children:[e(la,{}),e(Re,{orientation:"vertical",className:"mr-2 h-4"}),e(Ta,{children:e(ka,{children:e(ja,{children:e(Oa,{className:"line-clamp-1",children:a?.name})})})})]}),e(Da,{})]}),e("div",{className:"h-full overflow-y-hidden",children:e(Ye,{})})]})]})}const ur=function(){const t=be(xe),s=G(Ne),o=G(ze),{userId:l}=Ue.useRouteContext();return Pa(l),Q(()=>{const v=async()=>{const b=await Le();s(b)},c=async()=>{const b=await $e();o(b)};Promise.all([v(),c()])},[]),r(_e,{children:[e(Sa,{}),r(da,{className:"flex flex-col h-screen overflow-y-auto",children:[r("header",{className:"sticky top-0 flex h-14 shrink-0 items-center gap-2 bg-background p-4",children:[r("div",{className:"flex flex-1 items-center gap-2 px-3",children:[e(la,{}),e(Re,{orientation:"vertical",className:"mr-2 h-4"}),e(Ta,{children:e(ka,{children:e(ja,{children:e(Oa,{className:"line-clamp-1",children:t?.name})})})})]}),e(Da,{})]}),e("div",{className:"h-full overflow-y-hidden",children:e(Ye,{})})]})]})},hr=Object.freeze(Object.defineProperty({__proto__:null,component:ur,default:mr},Symbol.toStringTag,{value:"Module"}));export{ur as component,mr as default};
