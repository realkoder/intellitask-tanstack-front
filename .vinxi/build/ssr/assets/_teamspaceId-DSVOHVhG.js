import{jsxs as r,jsx as e}from"react/jsx-runtime";import{useSetAtom as L,useAtom as Z}from"jotai";import{z as K,x as ee,B as l,L as y,g as re,G as z,D as A,ag as se,C as j,k as te,a as P,b as T,T as S,p as U,q as R,r as F,c as M,h as O,d as D,F as B}from"./ssr-D494T9bW.js";import{FolderPlus as Q,Lock as Y,PlusCircle as ae,Home as ie,ChevronRight as le,Briefcase as E,Settings as W,FileText as ce,Users as q,RefreshCw as ne,ChevronDown as H,ChevronUp as V}from"lucide-react";import{useState as N,useEffect as $}from"react";import{useNavigate as oe,Link as G}from"@tanstack/react-router";import{S as x,M as de,C as me,a as he,b as pe}from"./collapsible-g0t8x5gf.js";import{toast as k}from"sonner";import{D as ue,a as ge,b as fe,c as xe,d as Ne,e as ve,f as be,g as we}from"./dialog-BARnul6K.js";import{C as Ce}from"./checkbox-C_SO_KyM.js";import{A as X}from"./avatar-pWQn_6aq.js";import"@vercel/analytics";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"zod";import"@radix-ui/react-slot";import"class-variance-authority";import"clsx";import"tailwind-merge";import"@radix-ui/react-label";import"better-auth/react";import"better-auth/client/plugins";import"input-otp";import"@radix-ui/react-select";import"@radix-ui/react-tooltip";import"@radix-ui/react-radio-group";import"@radix-ui/react-scroll-area";import"framer-motion";import"motion/react";import"@radix-ui/react-dropdown-menu";import"uuid";import"marked";import"react-markdown";import"remark-gfm";import"@radix-ui/react-hover-card";import"qss";import"@radix-ui/react-dialog";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"@radix-ui/react-tabs";import"@radix-ui/react-collapsible";import"@radix-ui/react-checkbox";import"@radix-ui/react-avatar";function _({teamspaceId:u,children:n}){const v=oe(),[o,g]=N(!1),c=L(K),b=L(ee),[a,d]=N({name:"",description:"",context:"",isPrivate:!1}),m=h=>{d({...a,[h.target.name]:h.target.value})},t=h=>{d({...a,isPrivate:h})};return r(ue,{children:[e(ge,{asChild:!0,children:n||r(l,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white hover:cursor-pointer",children:[e(Q,{className:"h-4 w-4 mr-2"})," New Project"]})}),e(fe,{className:"sm:max-w-[500px]",children:r("form",{onSubmit:async h=>{if(h.preventDefault(),!a.name.trim()){k.error("Project name is required");return}g(!0);try{const w=A(),f=(await w.auth.handler()).userID,{data:p}=await w.chatrooms.createProject({teamspaceId:u,name:a.name,description:a.description,context:a.context,creatorId:f,isPrivate:a.isPrivate,members:[{projectId:"",userId:f,role:"OWNER",invitedByUserId:f,hasAccepted:!0}]});b(p.id),c(I=>I.map(C=>C.id===u?{...C,projects:[...C.projects,p]}:C)),k.success("Project created successfully"),v({to:"/project/$projectId",params:{projectId:p.id},viewTransition:!0})}catch(w){console.error("Error creating project:",w),k.error("Failed to create project")}finally{g(!1)}},children:[r(xe,{children:[e("div",{className:"h-1.5 bg-emerald-500 w-full absolute top-0 left-0 rounded-t-lg"}),e(Ne,{className:"text-xl mt-2",children:"Create New Project"}),e(ve,{children:"Create a project in this teamspace to organize your work."})]}),r("div",{className:"grid gap-4 py-4",children:[r("div",{className:"grid gap-2",children:[r(y,{htmlFor:"project-name",children:["Project Name ",e("span",{className:"text-red-500",children:"*"})]}),e(re,{id:"project-name",name:"name",value:a.name,onChange:m,placeholder:"e.g. Marketing Campaign",required:!0})]}),r("div",{className:"grid gap-2",children:[e(y,{htmlFor:"project-description",children:"Description"}),e(z,{id:"project-description",name:"description",value:a.description,onChange:m,placeholder:"What is this project about?"})]}),r("div",{className:"grid gap-2",children:[e(y,{htmlFor:"project-context",children:"Context"}),e(z,{id:"project-context",name:"context",value:a.context,onChange:m,placeholder:"Any specific context for this project"})]}),r("div",{className:"flex items-center space-x-2",children:[e(Ce,{id:"isPrivate",checked:a.isPrivate,onCheckedChange:t}),r("div",{className:"grid gap-1.5 leading-none",children:[r(y,{htmlFor:"isPrivate",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center",children:[e(Y,{className:"h-3.5 w-3.5 mr-1.5 text-muted-foreground"}),"Make project private"]}),e("p",{className:"text-xs text-muted-foreground",children:"Private projects are only visible to invited members"})]})]})]}),r(be,{children:[e(we,{asChild:!0,children:e(l,{variant:"outline",type:"button",disabled:o,children:"Cancel"})}),e(l,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700",disabled:o,children:o?"Creating...":"Create Project"})]})]})})]})}const J=u=>{switch(u){case"OWNER":return"bg-green-100 text-green-800 border-green-200";case"ADMIN":return"bg-red-100 text-red-800 border-red-200";case"CONTRIBUTOR":return"bg-blue-100 text-blue-800 border-blue-200";case"VIEWER":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};function ye({members:u}){const[n,v]=N(!1),[o,g]=N(!1),c=5,b=u.filter((s,f,p)=>f===p.findIndex(I=>I.user?.id===s.user?.id)),a=b.filter(s=>!s.hasLeft),d=b.filter(s=>s.hasLeft),m=(s,f)=>{const p={OWNER:0,ADMIN:1,CONTRIBUTOR:2,VIEWER:3};return(p[s.role]||4)-(p[f.role]||4)},t=[...a].sort(m),i=[...d].sort(m),h=n?t:t.slice(0,a.length>=c?c:a.length),w=a.length>c&&!n;return r("div",{className:"space-y-3",children:[e("div",{children:h.map(s=>e("div",{className:"py-1.5",children:r("div",{className:"flex items-center justify-between group",children:[r("div",{className:"flex items-center gap-2",children:[e(X,{className:"h-7 w-7",children:s.user?.image?e("img",{src:s.user.image,alt:s.user?.name||"User"}):e("div",{className:"bg-gray-200 h-full w-full flex items-center justify-center text-gray-700 text-xs",children:(s.user?.name||"U").charAt(0)})}),e(S,{children:r(U,{children:[e(R,{asChild:!0,children:e("span",{className:"text-sm font-medium truncate max-w-[120px]",children:s.user?.name||"Unknown User"})}),r(F,{children:[e("p",{children:s.user?.name||"Unknown User"}),e("p",{className:"text-xs text-muted-foreground",children:s.user?.email})]})]})})]}),e(B,{className:J(s.role),children:s.role})]})},s.id))}),w&&e(l,{variant:"ghost",size:"sm",className:"w-full text-xs h-7",onClick:()=>v(!0),children:r("span",{className:"flex items-center",children:["Show ",a.length-c," More ",e(H,{className:"ml-1 h-3 w-3"})]})}),n&&a.length>c&&e(l,{variant:"ghost",size:"sm",className:"w-full text-xs h-7",onClick:()=>v(!1),children:r("span",{className:"flex items-center",children:["Show Less ",e(V,{className:"ml-1 h-3 w-3"})]})}),d.length>0&&r(me,{open:o,onOpenChange:g,className:"mt-3",children:[r("div",{className:"flex items-center text-xs text-muted-foreground",children:[e("div",{className:"h-px bg-border flex-grow mr-2"}),e(he,{asChild:!0,children:r("button",{className:"flex items-center gap-1 px-2 py-1 rounded-sm hover:bg-muted/50 transition-colors",children:[r("span",{children:["Former Members (",d.length,")"]}),o?e(V,{className:"h-3 w-3"}):e(H,{className:"h-3 w-3"})]})}),e("div",{className:"h-px bg-border flex-grow ml-2"})]}),e(pe,{className:"pt-2",children:e("div",{className:"space-y-1.5",children:i.map(s=>e("div",{children:r("div",{className:"relative flex items-center justify-between group py-1.5",children:[e("div",{className:"absolute inset-0 rounded-md bg-muted/30 pointer-events-none"}),r("div",{className:"flex items-center gap-2 z-10",children:[r("div",{className:"relative",children:[e(X,{className:"h-7 w-7",children:s.user?.image?e("img",{src:s.user.image,alt:s.user?.name||"User",className:"filter grayscale"}):e("div",{className:"bg-gray-200 h-full w-full flex items-center justify-center text-gray-700 text-xs",children:(s.user?.name||"U").charAt(0)})}),e("div",{className:"absolute -bottom-1 -right-1 rounded-full w-3 h-3 bg-muted border border-background flex items-center justify-center",children:e("span",{className:"text-[8px]",children:"Ã—"})})]}),e(S,{children:r(U,{children:[e(R,{asChild:!0,children:e("span",{className:"text-sm font-medium truncate max-w-[120px] text-muted-foreground",children:s.user?.name||"Unknown User"})}),r(F,{children:[e("p",{children:s.user?.name||"Unknown User"}),e("p",{className:"text-xs text-muted-foreground",children:s.user?.email}),e("p",{className:"text-xs text-red-500 mt-1",children:"No longer a member"})]})]})})]}),e(B,{className:`${J(s.role)} opacity-70`,children:s.role})]})},s.id))})})]})]})}const xr=function(){const{teamspaceId:n}=se.useParams(),[v,o]=Z(K),[g,c]=N(!1),[b,a]=N(!0),[d,m]=N("");$(()=>{A().auth.handler().then(({userID:i})=>{m(i)})},[]);const t=v.find(i=>i.id===n);return $(()=>{t&&a(!1)},[t]),b?r("div",{className:"flex-1 flex flex-col",children:[e("div",{className:"h-1.5 bg-gray-200 w-full"}),r("div",{className:"p-6 max-w-5xl mx-auto w-full flex-1",children:[r("div",{className:"mb-8 relative",children:[e(x,{className:"h-10 w-60 mb-2"}),e(x,{className:"h-4 w-full max-w-md mb-4"})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e("div",{className:"md:col-span-2 space-y-6",children:r("div",{children:[e("div",{className:"flex justify-between items-center mb-4",children:e(x,{className:"h-8 w-40"})}),r("div",{className:"space-y-3",children:[e(x,{className:"h-24 w-full"}),e(x,{className:"h-24 w-full"})]})]})}),r("div",{className:"space-y-6",children:[e(x,{className:"h-60 w-full"}),e(x,{className:"h-60 w-full"})]})]})]})]}):t?r("div",{className:"flex-1 flex flex-col",children:[e("div",{className:"h-1.5 bg-indigo-500 w-full"}),r("div",{className:"p-6 max-w-5xl mx-auto w-full flex-1",children:[r("div",{className:"flex items-center text-sm text-muted-foreground mb-4",children:[r(G,{to:"/chat",className:"flex items-center hover:text-foreground transition-colors",children:[e(ie,{className:"h-3.5 w-3.5 mr-1"}),"Home"]}),e(le,{className:"h-3.5 w-3.5 mx-1.5"}),r("span",{className:"font-medium text-foreground flex items-center",children:[e(E,{className:"h-3.5 w-3.5 mr-1.5"}),"Teamspace"]})]}),r("div",{className:"mb-8 relative",children:[r("div",{className:"flex items-center gap-3 mb-2",children:[e("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-100 text-indigo-700",children:e(E,{className:"h-5 w-5"})}),r("div",{children:[e("h1",{className:"text-3xl font-bold",children:t.name}),r("div",{className:"flex items-center mt-1",children:[e("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/20",children:"Teamspace"}),t.members&&t.members.length>0&&r("span",{className:"ml-2 text-sm text-muted-foreground",children:[t.members.length," member",t.members.length!==1?"s":""]})]})]})]}),e("div",{className:"mt-2",children:e("p",{className:"text-muted-foreground",children:t.description||"No description provided"})}),e("div",{className:"absolute top-0 right-0",children:r(l,{size:"sm",variant:"outline",children:[e(W,{className:"h-4 w-4 mr-2"})," Teamspace Settings"]})})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r("div",{className:"md:col-span-2 space-y-6",children:[r("div",{children:[r("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold",children:"Projects"}),e(_,{teamspaceId:t.id})]}),t.projects&&t.projects.length>0?e("div",{className:"space-y-3",children:t.projects.map(i=>e(j,{className:te("cursor-pointer transition-all border-l-4 border-l-transparent","hover:shadow-md hover:border-l-indigo-500 hover:bg-muted/30"),children:r(G,{to:"/project/$projectId",params:{projectId:i.id},className:"block",children:[r(P,{className:"pb-2",children:[r(T,{className:"text-lg flex items-center",children:[i.name,i.isPrivate&&e(S,{children:r(U,{children:[e(R,{asChild:!0,children:e("span",{children:e(Y,{className:"h-3 w-3 ml-2 text-red-500"})})}),e(F,{children:e("p",{children:"Private"})})]})})]}),e(M,{children:i.description||"No description"})]}),e(O,{className:"pt-2 text-sm text-muted-foreground",children:r("div",{className:"flex items-center gap-4",children:[r("div",{className:"flex items-center",children:[e(ce,{className:"h-4 w-4 mr-1"}),i.chatrooms?.length||0," chat",i.chatrooms?.length!==1?"s":""]}),r("div",{className:"flex items-center",children:[e(q,{className:"h-4 w-4 mr-1"}),i.members?.length||1," member",i.members?.length!==1?"s":""]})]})})]})},i.id))}):r("div",{className:"border rounded-lg p-8 text-center bg-muted/20",children:[e("h3",{className:"font-medium mb-2",children:"No projects yet"}),e("p",{className:"text-muted-foreground mb-4",children:"Start by creating your first project in this teamspace"}),e(_,{teamspaceId:n,children:r(l,{variant:"outline",children:[e(Q,{className:"h-4 w-4 mr-2"})," Create Project"]})})]})]}),r("div",{children:[e("h2",{className:"text-xl font-semibold mb-4",children:"Recent Activity"}),e("div",{className:"border rounded-lg p-4 bg-muted/20 text-center",children:e("p",{className:"text-muted-foreground",children:"Activity feed coming soon"})})]})]}),r("div",{className:"space-y-6",children:[r(j,{className:"border-t-4 border-t-indigo-500",children:[r(P,{children:[r(T,{className:"flex items-center justify-between",children:[e("span",{children:"Teamspace Context"}),e(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:cursor-pointer",onClick:()=>c(!g),children:e(W,{className:"h-4 w-4"})})]}),e(M,{children:"Add context about what this teamspace is for"})]}),e(D,{children:g?r("div",{className:"space-y-4",children:[e("textarea",{className:"w-full min-h-[150px] p-3 border rounded-md",placeholder:"Describe what this teamspace is used for...",value:t.context}),r("div",{className:"flex justify-end space-x-2",children:[e(l,{variant:"outline",size:"sm",onClick:()=>c(!1),children:"Cancel"}),e(l,{size:"sm",onClick:()=>c(!1),children:"Save"})]})]}):e("div",{className:"text-sm",children:e("p",{children:t.context})})})]}),r(j,{className:"border-t-4 border-t-indigo-500",children:[r(P,{children:[e(T,{children:"Members"}),e(M,{children:"People with access to this teamspace"})]}),e(D,{children:t.members&&t.members.length>0?e(ye,{members:t.members}):e("div",{className:"text-sm text-muted-foreground",children:"Only you have access to this teamspace"})}),e(O,{children:e(de,{type:"teamspace",teamspaceId:t.id,members:t.members||[],userId:d,onMembersChanged:()=>{A().chatrooms.getTeamspaces().then(({data:i})=>{i&&o(i)})},children:r(l,{size:"sm",variant:"outline",className:"w-full border-indigo-600/20 text-indigo-700 hover:bg-indigo-50 hover:cursor-pointer",children:[e(q,{className:"h-4 w-4 mr-2"})," Manage Members"]})})})]}),r(j,{className:"border-t-4 border-t-indigo-500",children:[e(P,{children:r(T,{className:"flex items-center justify-between",children:[e("span",{children:"Teamspace Stats"}),e(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e(ne,{className:"h-4 w-4"})})]})}),e(D,{children:r("div",{className:"space-y-2",children:[r("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Projects"}),e("span",{className:"font-medium",children:t.projects?.length||0})]}),r("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Members"}),e("span",{className:"font-medium",children:t.members?.length||0})]}),r("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Created"}),e("span",{className:"font-medium",children:new Date(t.createdAt).toLocaleDateString()})]})]})})]})]})]})]})]}):r("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center",children:[e("h2",{className:"text-2xl font-bold mb-4",children:"No teamspace selected"}),e("p",{className:"text-muted-foreground mb-6",children:"Select a teamspace from the sidebar to view its details and projects"}),r(l,{variant:"outline",children:[e(ae,{className:"h-4 w-4 mr-2"})," Create New Teamspace"]})]})};export{xr as component};
