import{jsx as s,jsxs as i,Fragment as F}from"react/jsx-runtime";import{k as x,z as V,B as y,g as z,E as Q,F as q,D as H}from"./ssr-D494T9bW.js";import*as w from"react";import{useState as C}from"react";import{D as K,a as X,b as G,c as J,d as Y,e as Z,f as _}from"./dialog-BARnul6K.js";import{A as ee}from"./avatar-pWQn_6aq.js";import{Users as se,Search as re,Plus as te,X as ae}from"lucide-react";import*as b from"@radix-ui/react-tabs";import{toast as h}from"sonner";import{useSetAtom as ie}from"jotai";import*as k from"@radix-ui/react-collapsible";function Ne({className:r,...n}){return s("div",{"data-slot":"skeleton",className:x("bg-primary/10 animate-pulse rounded-md",r),...n})}const ne=b.Root,j=w.forwardRef(({className:r,...n},l)=>s(b.List,{ref:l,className:x("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...n}));j.displayName=b.List.displayName;const R=w.forwardRef(({className:r,...n},l)=>s(b.Trigger,{ref:l,className:x("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...n}));R.displayName=b.Trigger.displayName;const I=w.forwardRef(({className:r,...n},l)=>s(b.Content,{ref:l,className:x("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...n}));I.displayName=b.Content.displayName;function pe(r){const[n,l]=C(!1),[P,O]=C("current"),[v,B]=C(""),[A,D]=C(!1),S=ie(V),N=[...r.type==="teamspace"?r.members.filter(e=>e.user?.name?.toLowerCase().includes(v.toLowerCase())||e.user?.email?.toLowerCase().includes(v.toLowerCase())).filter((e,t,a)=>t===a.findIndex(c=>c.user?.id===e.user?.id)):r.members.filter(e=>e.user?.name?.toLowerCase().includes(v.toLowerCase())||e.user?.email?.toLowerCase().includes(v.toLowerCase())).filter((e,t,a)=>t===a.findIndex(c=>c.user?.id===e.user?.id))].sort((e,t)=>{if(e.hasLeft!==t.hasLeft)return e.hasLeft?1:-1;const a={OWNER:0,ADMIN:1,CONTRIBUTOR:2,VIEWER:3};return(a[e.role]||4)-(a[t.role]||4)}),W=e=>{switch(e){case"OWNER":return"bg-green-100 text-green-800 border-green-200";case"ADMIN":return"bg-red-100 text-red-800 border-red-200";case"CONTRIBUTOR":return"bg-blue-100 text-blue-800 border-blue-200";case"VIEWER":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},$=async e=>{if(!A){D(!0);try{const t=H();if(r.type==="teamspace"){const a=r.members.find(f=>f.id===e);if(!a){h.error("Member not found");return}const c=a.hasLeft;await t.chatrooms.changeTeamspaceMemberStatus(r.teamspaceId,e,{kickStatus:!c}),S(f=>f.map(o=>{if(o.id===r.teamspaceId){const L=o.members?.map(d=>d.id===e?{...d,hasLeft:!a.hasLeft}:d)||[],g=o.projects?.map(d=>{const M=d.members?.map(u=>u.user?.id===a.user?.id?{...u,hasLeft:!a.hasLeft}:u)||[],m=d.chatrooms?.map(u=>{const p=u.members?.map(T=>T.user?.id===a.user?.id?{...T,hasLeft:!a.hasLeft}:T)||[];return{...u,members:p}})||[];return{...d,members:M,chatrooms:m}})||[];return{...o,members:L,projects:g}}return o})),c?h.success("Member re-invited successfully"):h.success("Member removed successfully")}else{const a=r.members.find(f=>f.id===e);if(!a){h.error("Member not found");return}const c=a.hasLeft;await t.chatrooms.changeProjectMemberStatus(r.projectId,e,{kickStatus:!c}),S(f=>f.map(o=>{if(o.id===r.teamspaceId){const L=o.projects?.map(g=>{if(g.id===r.projectId){const d=g.members?.map(m=>m.id===e?{...m,hasLeft:!a.hasLeft}:m)||[],M=g.chatrooms?.map(m=>{const u=m.members?.map(p=>p.user?.id===a.user?.id?{...p,hasLeft:!a.hasLeft}:p)||[];return{...m,members:u}})||[];return{...g,members:d,chatrooms:M}}return g})||[];return{...o,projects:L}}return o})),setTimeout(()=>l(!1),500),c?h.success("Member re-invited successfully"):h.success("Member removed successfully")}}catch(t){console.error("Error updating member status:",t),h.error("Failed to update member status")}finally{D(!1)}}},E=(()=>{const{userId:e}=r;if(r.type==="teamspace"){const t=r.members.find(a=>a.user.id===e);return t?.role==="OWNER"||t?.role==="ADMIN"}else{const t=r.members.find(a=>a.user.id===e);return t?.role==="OWNER"||t?.role==="ADMIN"}})(),U=e=>{const t=e.hasLeft;return i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center gap-3",children:[s(ee,{className:`h-8 w-8 ${t?"opacity-50":""}`,children:e.user?.image?s("img",{src:e.user.image,alt:e.user?.name||"User",className:t?"grayscale":""}):s("div",{className:`bg-gray-200 h-full w-full flex items-center justify-center text-gray-700 ${t?"bg-gray-100":""}`,children:(e.user?.name||"U").charAt(0)})}),i("div",{children:[i("div",{className:`font-medium flex items-center ${t?"text-muted-foreground":""}`,children:[e.user?.name||"Unknown User",t&&s("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded bg-gray-100 text-gray-500",children:"Left"})]}),s("div",{className:"text-sm text-muted-foreground",children:e.user?.email||""})]})]}),i("div",{className:"flex items-center gap-2",children:[s(q,{className:`${W(e.role)} ${t?"opacity-50":""}`,children:e.role}),E&&e.user.id!==r.userId&&s(y,{variant:t?"outline":"ghost",size:"icon",disabled:A,onClick:()=>$(e.id),className:`h-8 w-8 ${t?"border-green-200 hover:bg-green-50 hover:text-green-700":""}`,title:t?"Re-invite member":"Remove member",children:t?s(te,{className:"h-4 w-4 text-green-600"}):s(ae,{className:"h-4 w-4"})})]})]},e.id)};return i(K,{open:n,onOpenChange:l,children:[s(X,{asChild:!0,children:r.children||i(y,{size:"sm",variant:"outline",className:"w-full border-indigo-600/20 text-indigo-700 hover:bg-indigo-50",children:[s(se,{className:"h-4 w-4 mr-2"})," Manage Members"]})}),i(G,{className:"sm:max-w-[550px]",children:[i(J,{children:[i(Y,{children:["Manage ",r.type==="teamspace"?"Teamspace":"Project"," Members"]}),i(Z,{children:["View and manage who has access to this ",r.type]})]}),i(ne,{defaultValue:"current",value:P,onValueChange:O,className:"mt-4",children:[i(j,{className:"grid w-full grid-cols-2",children:[s(R,{value:"current",children:"Current Members"}),s(R,{value:"invite",disabled:!E,children:"Invite Members"})]}),i(I,{value:"current",className:"mt-4",children:[s("div",{className:"mb-4",children:i("div",{className:"relative",children:[s(re,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),s(z,{type:"text",placeholder:"Search members...",className:"pl-8",value:v,onChange:e=>B(e.target.value)})]})}),s(Q,{className:"h-[320px] rounded-md border p-4",children:s("div",{className:"space-y-4",children:N.length>0?i(F,{children:[N.some(e=>!e.hasLeft)&&i("div",{className:"mb-3",children:[s("h3",{className:"text-sm font-medium mb-2",children:"Active Members"}),s("div",{className:"space-y-3",children:N.filter(e=>!e.hasLeft).map(U)})]}),N.some(e=>e.hasLeft)&&i("div",{className:"mt-4",children:[i("div",{className:"mb-2 flex items-center text-xs text-muted-foreground",children:[s("div",{className:"h-px bg-border flex-grow mr-2"}),s("span",{children:"Former Members"}),s("div",{className:"h-px bg-border flex-grow ml-2"})]}),s("div",{className:"space-y-3 mt-3",children:N.filter(e=>e.hasLeft).map(U)})]})]}):s("div",{className:"text-center py-8 text-muted-foreground",children:"No members found"})})})]}),s(I,{value:"invite",className:"mt-4",children:i("div",{className:"bg-muted/40 rounded-md p-8 text-center",children:[s("h3",{className:"font-medium mb-2",children:"Invite Members"}),s("p",{className:"text-muted-foreground mb-6",children:"This feature is coming soon"}),s(y,{variant:"outline",onClick:()=>O("current"),children:"Back to Current Members"})]})})]}),s(_,{children:s(y,{variant:"outline",onClick:()=>l(!1),children:"Close"})})]})]})}const xe=k.Root,ye=k.Trigger,le=w.forwardRef(({className:r,...n},l)=>s(k.Content,{ref:l,className:x("overflow-hidden transition-all duration-300 ease-in-out",r),...n}));le.displayName="CollapsibleContent";export{xe as C,pe as M,Ne as S,ye as a,le as b};
